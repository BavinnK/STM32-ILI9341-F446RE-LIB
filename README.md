# STM32 ILI9341 Library Port for Nucleo-F446RE

This is a working port of [martnak's excellent STM32-ILI9341 library](https://github.com/martnak/STM32-ILI9341), specifically adapted to work with the **STM32 Nucleo-F446RE** board using the **STM32CubeIDE** workflow.

The original library is simple and efficient, but required several modifications to work with the HAL code generated by CubeIDE. This repository contains the modified files to save others the time and effort of debugging the porting process.

---

## What Was Changed

To make the library compatible with a standard STM32CubeIDE project, the following "brain surgery" was performed:

1.  **Corrected HAL Includes:** Changed all instances of `#include "stm32f7xx_hal.h"` to `#include "main.h"` to ensure the correct HAL drivers for the F4 series are used.
2.  **Removed Redundant Initializers:** The author's custom `MX_SPI_Init()` and `MX_GPIO_Init()` calls were removed from the library, as CubeIDE handles all hardware initialization in `main.c`.
3.  **Standardized Pin Definitions:** The pin definition macros in `ILI9341_STM32_Driver.h` were renamed (e.g., from `ILI9341_CS_PIN` to `LCD_CS_PIN`) to match what the `.c` files expected, resolving many compilation errors.
4.  **Fixed Hardcoded SPI/GPIO Calls:** The `ILI9341_GFX.c` file contained hardcoded GPIO ports and SPI handles (`hspi1`, `hspi5`). These were replaced with the macros defined in the header file to make the library configurable.
5.  **Resolved Global Scope Issue:** Added `extern SPI_HandleTypeDef hspi1;` to `main.h` to make the SPI handle visible to the library files, fixing the final "hspi1 undeclared" linker error.

---

## How to Use

1.  Set up a new STM32CubeIDE project for the Nucleo-F446RE.
2.  Configure one SPI peripheral (e.g., `SPI1` on `PA5`, `PA6`, `PA7`).
3.  Configure three GPIO pins as outputs for CS, DC, and RST.
4.  Copy the `ILI9341` folders from this repository into your project's `Core/Inc` and `Core/Src` directories.
5.  Add the `Core/Inc/ILI9341` path to your compiler's include paths.
6.  Modify the "USER DEFINITIONS" section in `ILI9341_STM32_Driver.h` to match your chosen pins.
7.  **Crucially:** Add `extern SPI_HandleTypeDef hspi1;` (or your SPI handle) to the `/* USER CODE BEGIN EFP */` section of your `main.h` file.
8.  Include the library headers in your `main.c` and start drawing!

### Example Wiring

*   **VCC** -> `3.3V`
*   **GND** -> `GND`
*   **LED** -> `3.3V` (Backlight)
*   **CLK** -> `PA5` (SPI1_SCK)
*   **MOSI** -> `PA7` (SPI1_MOSI)
*   **CS**  -> `PC7` (Your `LCD_CS_PIN`)
*   **DC**  -> `PB6` (Your `LCD_DC_PIN`)
*   **RST** -> `PA9` (Your `LCD_RST_PIN`)
